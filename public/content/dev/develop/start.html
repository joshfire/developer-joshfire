<h1>Create template entry point(s)</h1>

<p>Unless overridden in the manifest file, the starting point of the template is the <code>index.html</code> file in the top-level directory of the template. The starting point must be a valid HTML document.</p>


<h2>How to override the default entry point</h2>

<p>Web applications generated by the factory include a device detection mechanism that may redirect users automatically to different entry points based on the class of device they use.</p>

<p>To use this mechanism, your template must define alternative entry points for specific families of devices in the manifest file.</p>

<p>For instance, the following template manifest would generate a Web application where the entry point is <code>index.phone.html</code> for all mobile devices and <code>index.html</code> for all other types of devices:</p>

<pre><code class="json">{
  "name": "redirect",
  <em>[...]</em>
  "joshfire": {
    "devices": [
      {
        "devices": "phone",
        "startfile": "index.phone.html"
      },
      {
        "devices": "*",
        "startfile": "index.html"
      }
    ]
}</code></pre>

<p>See <a href="/doc/develop/devices">Support multiple devices</a> for more information.</p>


<h2>Link to bootstrap script</h2>

<p>All files used as template entry points must include a link to the <strong>bootstrap script</strong>. The bootstrap script maps template settings, e.g. the names and number of datasources inputs, to factory user selected values for these settings, e.g. the actual datasources feeds. See the <a href="/doc/develop/templateapi">Template API reference</a> for information about objects and functionalities exposed.</p>

<pre><code class="html">&lt;script data-joshfire-bootstrap&gt;&lt;/script&gt;</code></pre>

<p>When the generated Web application is started, the loading script detects and replaces this line automatically with the appropriate bootstrap JavaScript code. No further work is required from a template perspective to set things up.</p>


<h2>Bootstrap script during template development</h2>

<p>The main problem you will face during template development is that the factory can only generate the appropriate bootstrap script when:
<ul>
  <li>it knows about your template;</li>
  <li>there exists a Web application project that uses your template and binds datasource inputs to actual feeds.</li>
</ul>

<h3>How to create the bootstrap script for a new template</h3>

<p>By definition, the factory does not know anything about your template as long as it has not been <a href="/doc/develop/submit">submitted</a> to the github repository, and this is obviously something that you will only do when your template is ready for production.</p>

<p>The factory does not yet feature a development mode that would allow testing an unknown template. This means that you will have to generate the appropriate bootstrap script for your template and link to it from your template's entry point(s).</p>

<p>The bootstrap script is composed of two parts:</p>
<ul>
  <li>template and application information;</li>
  <li>a static part that provides the code needed to interface with the data proxy that you may download from <a href="#">@@@link</a>.</li>
</ul>

<p>You may use the following JavaScript snippet as starting point for your bootstrap script. Exposed objects link to the relevant section in the <a href="/doc/ref/templateapi">template API reference</a> for convenience.</p> 

<pre><code class="javascript">(function() {
  // Create/Reset joshfire.factory.config
  var Joshfire = window.Joshfire || {};
  Joshfire.factory = {
    config: {}
  };

  // Expose information about the template
  // <strong>TODO</strong>: provide the appropriate values for your template
  <a href="/doc/ref/templateapi#template">Joshfire.factory.config.template</a> = {
    "name": "",
    "version":"", 
    "options": {
      "<em>abouthtml</em>": ""
    }
  };

  // Expose information about the Web application
  // <strong>TODO</strong>: fill out values that your template relies on
  <a href="/doc/ref/templateapi#app">Joshfire.factory.config.app</a> = {
    "name": "<em>appname</em>",
    "description": "<em>appdescription</em>",
    "icon": {
      "itemType": "ImageObject",
      "contentURL": "<em>icon-uri</em>",
      "contentEncoding": "jpeg",
      "contentSize": <em>12345</em>,
      "width": <em>2048</em>,
      "height": <em>1536</em>
    },
    "logo": {
      "itemType": "ImageObject",
      "contentURL": "<em>icon-logo</em>",
      "contentEncoding": "png",
      "contentSize": <em>1234</em>,
      "width": <em>1024</em>,
      "height": <em>1024</em>
    }
  };

  // Expose information about configured datasources.
  // The code below is an example of what a Flickr search would look like.
  // To ensure you have the right parameters here, we recommend that you
  // create a Web application bound to another template in the factory, and
  // extract the relevant datasources from the generated bootstrap script.
  // The generated bootstrap script is returned by the following address
  // provided you replace <em>[appid]</em> by the ID of your Web application:
  // http://factory.joshfire.com/bootstrap/<em>[appid]</em>/auto/auto/
  // <strong>TODO</strong>: replace example below with actual datasources
  <a href="/doc/ref/templateapi#datasources">Joshfire.factory.config.datasources</a> = {
    "pictures": [
      {
        "name": "<em>name</em>",
        "db": "<em>flickr</em>",
        "col": "<em>photos</em>",
        "query": {
          "filter": {
            "search": "<em>joshfire</em>",
            "set": "",
            "api_key": ""
          },
          "options": {}
        },
        "config": {
          "search": "<em>joshfire</em>",
          "set": "",
          "api_key": ""
        }
      }
    ]
  };

  // Expose information about installed plugins
  <a href="/doc/ref/templateapi#plugins">Joshfire.factory.config.plugins</a> = {};

  // Expose Joshfire as a global object
  window.Joshfire = Joshfire;
})();</code></pre>

<p>Once filled up to suit your needs, the above code snippet needs to be merged with the static part of the bootstrap script. You can then add the resulting script as content of the bootstrap script <code>&lt;script&gt;</code> tag mentioned above or use its <code>src</code> attribute. In both cases, the factory will drop this content when it generates the Web application.</p>

<p>That's it. Now open your template's entry point in a Web browser to test its functionality.</p>

<h3>How to test a template update</h3> 

<p>If the template you'd like to test is an update to an existing template, and provided the update does not change the manifest file, you do not need to go through the exercise explained above. Instead, you may use the factory to create an application that uses the original template and link to the generated bootstrap script to test the update on your local machine.</p>

<p>Replacing <code><em>[appid]</em></code> with the ID of your application (which appears in the link to the application in the applications list page), the bootstrap script for your template and application is available at:</p>
<pre><code class="uri">http://factory.joshfire.com/bootstrap/<em>[appid]</em>/auto/auto/</code></pre>

<p>You can then use the <code>src</code> attribute in the reference to the bootstrap script to test the template locally, for instance:</p>
<pre><code class="html">&lt;script data-joshfire-bootstrap
  src="http://factory.joshfire.com/bootstrap/4ea47636d58da375e7000080/auto/auto/"&gt;
&lt;/script&gt;</code></pre>

<p>The factory also allows users to configure templates parameters differently for different families of devices. For instance, factory users may want to bind one of the template's datasources inputs with an RSS feed that only contains smaller images and shorter abstracts on mobile phones, while they may prefer to see more content on desktops.</p>

<p>From a template perspective, the existence of different configuration settings is entirely transparent: the bootstrap script that gets loaded when the Web application starts already exposes the right information for the user's device. To test this possibility during template development, you may replace the last <code>auto</code> in the above mentioned bootstrap generator address with the family name of the device whose configuration settings you'd like to test, for instance:</p>
<pre><code class="uri">http://factory.joshfire.com/bootstrap/<em>[appid]</em>/auto/<strong>phone</strong>/
http://factory.joshfire.com/bootstrap/<em>[appid]</em>/auto/<strong>tv</strong>/
http://factory.joshfire.com/bootstrap/<em>[appid]</em>/auto/<strong>tablet</strong>/
http://factory.joshfire.com/bootstrap/<em>[appid]</em>/auto/<strong>desktop</strong>/
http://factory.joshfire.com/bootstrap/<em>[appid]</em>/auto/<strong>object</strong>/</code></pre>

